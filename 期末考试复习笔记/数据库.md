# 第一章节概述

## 数据库的特点

​    永久存储，有组织结构和可共享，数据独立的特点。

## DBMS主要功能

1. DDL
2. DML
3. 数据组织存储和管理
4. 数据事务管理和运行管理
5. 数据库建立和维护

 ## 数据库系统特点

1. 数据结构化

  实现数据整体系统结构化，数据不仅仅是内部结构化，而是整体结构化，数据和数据之间是具有联系的

2. 数据共享性，低冗余易扩展

3. 数据的独立性高

  物理独立性和逻辑渡路行

4. 数据由DBMS统一管理和控制
   1. 安全性保护
   2. 完整性检查
      1. 数据完整性，正确、有效、相容性
   3. 并发控制
   4. 数据库恢复

## 数据模型

  通常由数据结构、数据操作、数据完整性约束构成。

### 概念模型

  简单来说是根据用户观点来对数据和信息进行建模，主要用于数据库设计。了解基本概念，实体、属性、码、实体型、联系

### 逻辑模型和物理模型

  逻辑模型包括层次、网状、关系、面向对象....

  物理模型则是数据在系统内部的表示方式和存取方法。

### ** 关系模型

  我们可以直接理解为关系模型就是一张二维表，有着元组，属性，码，域，分量的概念





---

- 依赖传递。。。
- 事务
- 数据库安全



---

## 简答题

 ###  数据库阶段数据管理特色: 

1. 采用复杂的数据模型表示数据结构(记录结构化)
2. 有较高的数据独立性(数据完全物理独立与应用程序，大部分逻辑独立于应用程序)
3. 为用户提供方便的用户接口
4. 数据还提供数据故障恢复，并发控制，数据完整性检查，数据安全可靠，保证了数据库系统的正确、安装和可靠
5. 对数据的操作不一定是记录为单位，二十以最小的数据项为单位，从而增加了系统的灵活性。

### 数据模型的三要素

1. 数据结构、数据操作和完整性约束三部分组成。

数据结构是研究对象和对象的特征和对象的联系的集合，它是对数据静态的描述。

数据操作是对数据库当中各种对象的实例允许的执行的操作集合，包含和操作和操作规则。

完整性约束是完整性规则的集合，包括部分，实体完整性，参照完整性，以及用户完整性。完整性是对给定的数据模型中数据给定要求



### 数据库设计步骤

### 什么是数据库独立性，数据库独立性是怎么得到保证的？



### 什么是事务，它的特性有哪些？

###  数据库故障有什么种类，恢复策略如何





---

### 创建类

创建一个**存储过程**，以姓名为参数，可以通过姓名对学生表进行模糊查询。学生表为：

student(sno,sname,sex,age,sdept).

```sql
create procedure likeSeachechStu
	@name varchar(50)
as 
begin
	select * from student where name like "%"+@name+"%" 
end
```

创建一个**触发器**，当修改学生成绩时，将修改前成绩和修改后成绩存入一个日志表。学生成绩表为 sc(sno,cno,grade)。日志表为：（sno,cno,oldgrade,newgrade）。

```sql
CREATE TRIGGER trg_UpdateGrade
ON sc
AFTER UPDATE
AS
BEGIN
    DECLARE @sno char(10), @cno char(10), @oldgrade int, @newgrade int
    
    SELECT @sno = i.sno, @cno = i.cno, @oldgrade = d.grade, @newgrade = i.grade
    FROM inserted i
    JOIN deleted d ON i.sno = d.sno AND i.cno = d.cno
    
    INSERT INTO log_table (sno, cno, oldgrade, newgrade)
    VALUES (@sno, @cno, @oldgrade, @newgrade)
END
```







# 十、数据库恢复技术

## 1. 事务

### 概念

  事务是用户定义的一个数据库操作序列，事务具有以下特性ACID

- 原子性
- 一致性

  一致性指的是数据库在操作的过程中，这个事务操作要么全做，要么全部做，如果只做一半，那么就会失去数据库中的一致性。

- 隔离性

- 持久性

> 数据库还要保证在并发的操作中，依然要保证的各个事务之间的相互独立性，这就涉及到事务的隔离等级了。



## 2. 数据库的恢复

### 概述

  尽管数据库做了许多方法以保证数据的安全和完整性的保护，使用隔离来保证并发事务的正确执行，但是有些错误是不可避免的，如计算机硬件故障，软件的错误执行，这些操作轻则影响数据的正确性，重则会破坏整个数据库，所以我们引用了数据库恢复技术，来以备不时之需。

> 数据库恢复技术也是一项衡量数据库优劣的重要指标，与数据库安全性和完整性同样重要。

## 3. 故障种类

  数据库发生种类可以以软故障和硬故障来划分。

1. 事务故障
2. 系统故障
3. 介质故障
4. 计算机病毒

  故障对数据库的影响有两种，一种是数据库本身被破坏，二是数据不正确。

> 建立冗余数据，以备数据库出现损坏时进行恢复。



## 4. 恢复实现技术

  使用冗余数据进行对数据库的恢复，这个冗余数据做常用的数据转储和登记日志文件。

- 数据转储指对数据库的备份，将数据备份到磁盘当中。
- 登记日志文件，是对每一项事务操作进行记录，当某件事务出错或者系统出错损坏数据时，可以扫描日志文件，决定如果恢复数据。

### 1. 数据转储

  数据转储是定期将数据将数据库文件存储到存储介质中保存的过程，当数据遭受破坏时候，将备份文件重新装入。转储分为静态转储和动态转储。

- 静态转储: 指停掉数据库的操作，等到所有的用户操作结束，保证数据库数据一致性进行文件备份。
- 动态转储: 转储和用户事务可以并发执行，不需要等待用户事务结束，不损失数据库的可用性。

> 在转储期间必须建立日志文件保证某一时刻中数据的正确性。

![image-20221129104615411](C:\Users\JaneOnly\AppData\Roaming\Typora\typora-user-images\image-20221129104615411.png)

  ### 2.登记日志文件

  日志文件是用于记录事务对数据的修改操作。日志文件主要有两种格式，**记录和数据块**。

  日志需要登记的内容

- 各个事务开始
- 各个事务结束
- 各个事务的更新。

  日志主要记录包括

- 事务的标识(ID)
- 操作类型
- 操作对象
- 更新前后的信息

登记文件必须遵守两条原则

- 登记的次序必须严格按照事务执行的次序
- 必须先写数据库，再写文件

  

# 5. 恢复策略

 针对之前不同的故障，会有不同的恢复策略，以将数据库恢复到之前的某个状态。

### 1. 事务故障的恢复

  事务的故障恢复是利用日志文件UNDO，该操作对用户来说是透明.

  步骤:

1. 从后向前扫描日志文件，查找事务更新操作
2. 对事物的更新操作执行逆操作。
3. 重复1,2,直到扫描到事务begin标记。

### 2. 系统故障恢复

  系统故障恢复是由系统重启后自动完成的，不需要手动干预。

 步骤: 

1. 正向扫描文件，找到故障发生前已提交的事务,移动到REDO-list，找出故障发生前未提交的事务移动到UNDO-list
2. 对REDO和UNDO队列做处理。

### 3. 介质故障恢复

![image-20221129115200110](C:\Users\JaneOnly\AppData\Roaming\Typora\typora-user-images\image-20221129115200110.png)

## 6. 检查点

  在利用日志恢复记录时候，恢复数据库系统必须要检索日志，而日志记录的会是很大的工程，这样存在两个问题: 

1. 日志检索消耗巨多时间
2. 数据库有时故障并不需要执行所有事务操作。

  基于以上两种问题，引入了检查点几率，增减一个重新开始的文件，用于记录日志记录的地址。

![image-20221129115447303](C:\Users\JaneOnly\AppData\Roaming\Typora\typora-user-images\image-20221129115447303.png)

> 需要周期性检查建立检查点，保存数据数据库状态操作。

  检查点恢复步骤



![image-20221129120625732](C:\Users\JaneOnly\AppData\Roaming\Typora\typora-user-images\image-20221129120625732.png)